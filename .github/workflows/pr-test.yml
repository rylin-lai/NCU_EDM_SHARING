name: PR Test - Python & Golang
# PR æ¸¬è©¦ - Python å’Œ Golang

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  test:
    name: Test TLSH Analyzer
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code / æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: Setup Python / è¨­ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    - name: Setup Go / è¨­ç½® Go
      uses: actions/setup-go@v4
      with:
        go-version: "1.20"
        
    - name: Install dependencies / å®‰è£ä¾è³´
      run: |
        sudo apt-get update && sudo apt-get install -y build-essential cmake jq
        python -m pip install --upgrade pip
        pip install tlsh-python pytest pytest-mock
        
    # ========================================
    # å»ºç½® Golang Binary / Build Golang Binary
    # ========================================
    - name: ğŸ”§ Build Golang Binary
      working-directory: ./workshop_materials/golang
      run: |
        echo "ğŸ”§ Building Golang TLSH Text Analyzer"
        echo "===================================="
        
        # æª¢æŸ¥ Go ç’°å¢ƒ / Check Go environment
        go version
        
        # å»ºç½® binary / Build binary
        go mod tidy
        GOOS=linux GOARCH=amd64 go build -o tlsh-text-analyzer-linux main.go
        ls -la tlsh-text-analyzer-linux
        chmod +x tlsh-text-analyzer-linux
        
        echo "âœ… Golang binary built successfully"
        
    # ========================================
    # è·¨å¹³å° pytest æ¸¬è©¦ / Cross-platform pytest Tests
    # ========================================
    - name: ğŸ§ª Run Cross-platform pytest Tests
      working-directory: ./workshop_materials
      run: |
        echo "ğŸ§ª Running Cross-platform pytest Tests"
        echo "======================================="
        
        # åŸ·è¡Œè·¨å¹³å°æ¸¬è©¦ / Run cross-platform tests
        python -m pytest test_cross_platform.py -v --tb=short --durations=5
        
        # åŸ·è¡ŒåŸæœ‰çš„ Python å–®å…ƒæ¸¬è©¦ / Run original Python unit tests
        python -m pytest test_tlsh_analyzer.py -v --tb=short
        
        echo "âœ… All pytest tests completed successfully"
        