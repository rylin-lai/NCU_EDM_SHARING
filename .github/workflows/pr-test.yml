name: String Reverser Test - Python & Golang
# å­—ä¸²åè½‰å™¨æ¸¬è©¦ - Python å’Œ Golang

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  test:
    name: Test String Reverser
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code / æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: Setup Python / è¨­ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    - name: Setup Go / è¨­ç½® Go
      uses: actions/setup-go@v4
      with:
        go-version: "1.20"
        
    - name: Install dependencies / å®‰è£ä¾è³´
      run: |
        echo "ğŸ” Checking repository structure"
        pwd
        ls -la
        echo "ğŸ” Looking for workshop_materials directory"
        find . -name "workshop_materials" -type d | head -5
        
        sudo apt-get update && sudo apt-get install -y build-essential jq
        python -m pip install --upgrade pip
        pip install pytest pytest-mock pytest-html pytest-xdist
        
    # ========================================
    # æ¸¬è©¦ Python å’Œ Golang å­—ä¸²åè½‰å™¨ / Test Python and Golang String Reverser
    # ========================================
    - name: ğŸ§ª Test String Reverser Cross-Platform
      run: |
        echo "ğŸ§ª Testing String Reverser Cross-Platform"
        echo "========================================"
        
        # æª¢æŸ¥ä¸¦é€²å…¥æ­£ç¢ºçš„ç›®éŒ„ / Check and navigate to correct directory
        echo "Current directory: $(pwd)"
        echo "Looking for test files:"
        find . -name "test_string_reverser.py" | head -5
        find . -name "string_reverser.py" | head -5
        
        # å˜—è©¦ä¸åŒçš„è·¯å¾‘ / Try different paths
        if [ -d "workshop_materials" ]; then
          cd workshop_materials
          echo "âœ… Found workshop_materials directory"
        elif [ -f "./test_string_reverser.py" ]; then
          echo "âœ… Test files found in current directory"
        else
          echo "âŒ Cannot find test files"
          find . -name "*.py" | head -10
          exit 1
        fi
        
        pwd
        ls -la *.py 2>/dev/null || echo "No Python files found"
        ls -la golang/ 2>/dev/null || echo "No golang directory found"
        
        # æª¢æŸ¥ Go ç’°å¢ƒ / Check Go environment  
        go version
        
        # æ¸¬è©¦ Python è…³æœ¬æ˜¯å¦èƒ½åŸ·è¡Œ / Test if Python script can run
        echo "ğŸ§ª Testing Python script execution"
        python string_reverser.py --help || echo "Python script failed to run"
        
        # åŸ·è¡Œè·¨å¹³å°æ¸¬è©¦ / Run cross-platform tests
        echo "ğŸš€ Running pytest cross-platform tests"
        python -m pytest test_string_reverser.py -v --tb=short --durations=5 \
          --junitxml=test-results-string-reverser.xml \
          --html=test-report-string-reverser.html --self-contained-html
        
        echo "âœ… String reverser tests completed"
        
    # ========================================
    # ä¸Šå‚³æ¸¬è©¦çµæœ / Upload Test Results  
    # ========================================
    - name: ğŸ“Š Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()  # å³ä½¿æ¸¬è©¦å¤±æ•—ä¹Ÿä¸Šå‚³ / Upload even if tests fail
      with:
        name: string-reverser-test-results
        path: |
          test-results-*.xml
          test-report-*.html
          python_*.json
          golang_*.json
        retention-days: 30
        
    - name: ğŸ“‹ Publish Test Report
      uses: dorny/test-reporter@v1
      if: always()  # å³ä½¿æ¸¬è©¦å¤±æ•—ä¹Ÿç™¼å¸ƒ / Publish even if tests fail
      with:
        name: String Reverser Cross-Platform Tests
        path: 'test-results-*.xml'
        reporter: java-junit
        fail-on-error: false
        